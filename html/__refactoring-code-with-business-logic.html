<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactoring: Code with Business Logic</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/pygmentize.css">

    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

</head>

<body>

    

    <div id="post-content">
        <h1 id="refactoring-code-with-business-logic">Refactoring: Code with Business Logic</h1>
<!-- ID: 202311010010 -->
<p>Last Updated: <em>2023-11-01</em></p>
<hr />
<p>Refactoring can be difficult and time-consuming, but it is <em>absolutely necessary</em> if one wants to maintain a clean codebase and have code which is easy to read, extend, scale, and share.</p>
<p>I'll show an example of how I would refactor a specific small project. <em>Note that this may not be how everyone refactors and I may make some choices which others may have done differently</em>.  In my refactors, for example, I tend to favor what I consider to be "Pythonic" readability over minor optimizations.</p>
<p>I'll work in Python for this post but all of these issues can and do pop up in every other language and are solved in similar ways.</p>
<h2 id="the-problem-and-first-solution">The Problem and First Solution</h2>
<p><strong>Problem</strong>: The job of the following code is to make a (string) label for another module when it is called.  For example, it may return "Minor: Prime (New Customer)" which implies the customer is under 18 years old, has Prime FICO rating (don't worry if you don't know what this is!), and is a new customer.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ORIGINAL, NO REFACTORING.</span>

<span class="c1"># customer_type.py</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="c1"># a: first name</span>
    <span class="c1"># b: last name</span>
    <span class="c1"># c: age</span>
    <span class="c1"># d: fico score</span>
    <span class="c1"># e: previous customer???</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">580</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Deep Subprime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Deep Subprime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">580</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Subprime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Subprime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">619</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Near Prime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Near Prime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">660</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">719</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Prime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Prime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">720</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Super-Prime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Super-Prime (New Customer)&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">580</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Deep Subprime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Deep Subprime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">580</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Subprime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Subprime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">619</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Near Prime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Near Prime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">660</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">719</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Prime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Prime (New Customer)&quot;</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">720</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Super-Prime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Adult: Super-Prime (New Customer)&quot;</span>
</code></pre></div></td></tr></table></div>

<p>It may be surprising (or not) to know that this is (strongly) based on a real function I inherited while at a past job.  At least they gave us some comments on what the arguments mean!</p>
<p>There's a lot to pick through, so I'm going to list some things which aren't great:</p>
<ul>
<li>Non-descriptive variable names and Unused Variables,</li>
<li>Repetition of similar code,</li>
<li>Functions / Classes which are doing many things at once,</li>
<li>"Magic Numbers" (numbers which are seemingly random in the code),</li>
<li>No Type Hinting (very common in Python code, as type hinting is optional),</li>
<li>No Docstrings / Documentation.</li>
</ul>
<p>Reading through the code, I get the gist of what's going on: lots of <code>if</code>-statements which eventually spit some label out.  Ask yourself: what would have to be done here if a new range of score was added?  What if I had a new age group (say, "&gt; 65")?  How much more frustrating would this code be to read through?</p>
<h2 id="non-descriptive-variable-names-and-unused-variables">Non-Descriptive Variable Names and Unused Variables</h2>
<p>There are few (if any) reasons these days not to make a variable name expressive. In the past, due to space limitations, variables might look like <code>CLS21</code> and have a data dictionary which noted what meant what.  Today, I can expand them out to make them more clear.</p>
<p>Additionally, let's take out any variables/arguments which are not being used by the code.  There may be reasons to keep these variables in (for example, to make a connection work with an existing API) but I will assume they are unnecessary in this case.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># FIRST REFACTOR: Descriptive Variable Names, No Unused Variables.</span>

<span class="c1"># customer_type.py</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">fico_score</span><span class="p">,</span> <span class="n">is_previous_customer</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&lt;</span> <span class="mi">580</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_previous_customer</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Deep Subprime (Previous Customer)&quot;</span>
            <span class="k">if</span> <span class="n">is_previous_customer</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Minor: Deep Subprime (New Customer)&quot;</span>
<span class="o">...</span>
<span class="o">...</span>
</code></pre></div></td></tr></table></div>

<p>At this point, I can remove the "docs" at the top since the variables are expressive.  I'll put a proper docstring in later.</p>
<h2 id="repetition-dont-repeat-yourself-dry">Repetition, Don't Repeat Yourself (DRY)</h2>
<p>One important principle to consider when refactoring is <em>DRY: Don't Repeat Yourself</em>.  When you have virtually identical code that appears two or more times, you may want to consider making this code into its own variable, function, or class.  One main reason for this is: if you need to change or debug the code, then you only need to change or debug it in one place instead of however many times you've copy-pasted it.  Much easier, much less error-prone.</p>
<p>There are three obvious places to do this in the code above: the <code>if</code>-statement that checks for previous customer or new customer, the <code>if</code>-statement which checks for "Minor / Adult" and the <code>if</code>-statement that checks the score.</p>
<p>In order to refactor these statements, it may be better to make a "template string" which is filled in with some variables as the <code>if</code>-statements are worked through.  For example, I start with the blank string, then add in if the customer is a Minor, then add in the Credit Rating, then add in New Customer or not.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># SECOND REFACTOR: TEMPLATE STRINGS + UNNESTING IFs</span>

<span class="c1"># customer_type.py</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">fico_score</span><span class="p">,</span> <span class="n">is_previous_customer</span><span class="p">):</span>

    <span class="n">customer_age_label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">credit_rating</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">prev_or_new_cust</span> <span class="o">=</span><span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="n">customer_age_label</span> <span class="o">=</span> <span class="s2">&quot;Minor&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">customer_age_label</span> <span class="o">=</span> <span class="s2">&quot;Adult&quot;</span>

    <span class="k">if</span> <span class="n">is_previous_customer</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">prev_or_new_cust</span> <span class="o">=</span> <span class="s2">&quot;Previous Customer&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prev_or_new_cust</span> <span class="o">=</span> <span class="s2">&quot;New Customer&quot;</span>

    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&lt;</span> <span class="mi">580</span><span class="p">:</span>
        <span class="n">credit_rating</span> <span class="o">=</span> <span class="s2">&quot;Deep-Subprime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;</span> <span class="mi">580</span> <span class="ow">and</span> <span class="n">fico_score</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
        <span class="n">credit_rating</span> <span class="o">=</span> <span class="s2">&quot;Subprime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;</span> <span class="mi">619</span> <span class="ow">and</span> <span class="n">fico_score</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
        <span class="n">credit_rating</span> <span class="o">=</span> <span class="s2">&quot;Near-Prime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;</span> <span class="mi">660</span> <span class="ow">and</span> <span class="n">fico_score</span> <span class="o">&lt;=</span> <span class="mi">719</span><span class="p">:</span>
        <span class="n">credit_rating</span> <span class="o">=</span> <span class="s2">&quot;Prime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;=</span> <span class="mi">720</span><span class="p">:</span>
        <span class="n">credit_rating</span> <span class="o">=</span> <span class="s2">&quot;Super Prime&quot;</span>

    <span class="n">customer_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{customer_age_label}</span><span class="s2">: </span><span class="si">{credit_rating}</span><span class="s2"> (</span><span class="si">{prev_or_new_cust}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
        <span class="s1">&#39;customer_age_label&#39;</span><span class="p">:</span> <span class="n">customer_age_label</span><span class="p">,</span>
        <span class="s1">&#39;credit_rating&#39;</span><span class="p">:</span> <span class="n">credit_rating</span><span class="p">,</span>
        <span class="s1">&#39;prev_or_new_cust&#39;</span><span class="p">:</span> <span class="n">prev_or_new_cust</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">customer_label</span>
</code></pre></div></td></tr></table></div>

<p>While not <em>perfect</em>, it's certainly cleaner and shorter.  There is one Python-specific thing we've done, which is the "<a href="https://docs.python.org/3/tutorial/inputoutput.html#the-string-format-method">string format() method</a>" at the bottom.  This formatting allows us to easily create strings and use a dictionary to fill things in (notice the <code>**</code> which unpacks the dictionary in the <code>.format</code> method).  If you don't use Python, or don't want to use string formatting like this, it's also easy to add these variables together in an appropriate way once I have them.</p>
<h2 id="functions-doing-more-than-one-thing">Functions Doing More Than One Thing</h2>
<p><strong>This function is doing quite a bit.</strong>  It's checking credit rating, if someone is a minor or not, if they're a new or returning customer.  If I was given a ton of business logic, this might become much larger and more difficult to debug.  Let's break this up into smaller functions.  While I'm at it, let's also <em>put in <a href="https://docs.python.org/3/library/typing.html">type hints</a></em>,</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># THIRD REFACTOR: FUNCTIONS SHOULD DO ONE THING.</span>
<span class="c1"># customer_type.py</span>

<span class="k">def</span> <span class="nf">customer_age_label</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;Minor&quot;</span> <span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span> <span class="k">else</span> <span class="s2">&quot;Adult&quot;</span>

<span class="k">def</span> <span class="nf">credit_rating_label</span><span class="p">(</span><span class="n">fico_score</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&lt;</span> <span class="mi">580</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Deep-Subprime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;</span> <span class="mi">580</span> <span class="ow">and</span> <span class="n">fico_score</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Subprime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;</span> <span class="mi">619</span> <span class="ow">and</span> <span class="n">fico_score</span> <span class="o">&lt;=</span> <span class="mi">620</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Near-Prime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;</span> <span class="mi">660</span> <span class="ow">and</span> <span class="n">fico_score</span> <span class="o">&lt;=</span> <span class="mi">719</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Prime&quot;</span>
    <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&gt;=</span> <span class="mi">720</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Super Prime&quot;</span>

<span class="k">def</span> <span class="nf">previous_customer_label</span><span class="p">(</span><span class="n">is_previous_customer</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;Previous Customer&quot;</span> <span class="k">if</span> <span class="n">is_previous_customer</span> <span class="k">else</span> <span class="s2">&quot;New Customer&quot;</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fico_score</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_previous_customer</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

    <span class="n">minor_or_adult</span> <span class="o">=</span> <span class="n">customer_age_label</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
    <span class="n">credit_rating</span> <span class="o">=</span> <span class="n">credit_rating_label</span><span class="p">(</span><span class="n">fico_score</span><span class="p">)</span>
    <span class="n">prev_or_new_cust</span> <span class="o">=</span> <span class="n">previous_customer_label</span><span class="p">(</span><span class="n">is_previous_customer</span><span class="p">)</span>

    <span class="n">customer_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{minor_or_adult}</span><span class="s2">: </span><span class="si">{credit_rating}</span><span class="s2"> (</span><span class="si">{prev_or_new_cust}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
        <span class="s1">&#39;minor_or_adult&#39;</span><span class="p">:</span> <span class="n">minor_or_adult</span><span class="p">,</span>
        <span class="s1">&#39;credit_rating&#39;</span><span class="p">:</span> <span class="n">credit_rating</span><span class="p">,</span>
        <span class="s1">&#39;prev_or_new_cust&#39;</span><span class="p">:</span> <span class="n">prev_or_new_cust</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">customer_label</span>
</code></pre></div></td></tr></table></div>

<p>In Python, type hints are not required (nor are they checked unless you have <a href="http://mypy-lang.org/">mypy</a>, which I recommend using), but it is important to get into the habit of giving type hints (or, for some other languages, using types when auto-types aren't obvious).  This allows us to see, at a glance, which functions are returning what types of things.</p>
<h2 id="magic-numbers">Magic Numbers</h2>
<p><strong><a href="https://en.wikipedia.org/wiki/Magic_number_(programming)">Magic Numbers</a></strong> are numbers in code which are meaningful but perhaps not obviously so.  These often should be replaced with constants with a meaningful name which tells us what the magic number means.</p>
<p>In this code, I have the FICO score bounds. Luckily, these are bins and I can do a standard bin structure with an <code>for</code>-loop, but there are many other equally nice ways to do this construction.  Here's one:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># FOURTH REFACTOR: NO MAGIC NUMBERS.</span>

<span class="c1"># customer_type.py</span>
<span class="n">FICO_UPPER_BOUNDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Deep-Subprime&quot;</span><span class="p">:</span> <span class="mi">579</span><span class="p">,</span>
    <span class="s2">&quot;Subprime&quot;</span><span class="p">:</span> <span class="mi">619</span><span class="p">,</span>
    <span class="s2">&quot;Near-Prime&quot;</span><span class="p">:</span> <span class="mi">659</span><span class="p">,</span>
    <span class="s2">&quot;Prime&quot;</span><span class="p">:</span> <span class="mi">719</span><span class="p">,</span>
    <span class="s2">&quot;Super-Prime&quot;</span><span class="p">:</span> <span class="mi">850</span>
<span class="p">}</span>

<span class="n">MINOR_AGE_UPPER_BOUND</span> <span class="o">=</span> <span class="mi">18</span>

<span class="k">def</span> <span class="nf">customer_age_label</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;Minor&quot;</span> <span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="n">MINOR_AGE_UPPER_BOUND</span> <span class="k">else</span> <span class="s2">&quot;Adult&quot;</span>

<span class="k">def</span> <span class="nf">credit_rating_label</span><span class="p">(</span><span class="n">fico_score</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="n">FICO_UPPER_BOUNDS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fico_score</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lbl</span>

<span class="k">def</span> <span class="nf">previous_customer_label</span><span class="p">(</span><span class="n">is_previous_customer</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;Previous Customer&quot;</span> <span class="k">if</span> <span class="n">is_previous_customer</span> <span class="k">else</span> <span class="s2">&quot;New Customer&quot;</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fico_score</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_previous_customer</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

    <span class="n">minor_or_adult</span> <span class="o">=</span> <span class="n">customer_age_label</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
    <span class="n">credit_rating</span> <span class="o">=</span> <span class="n">credit_rating_label</span><span class="p">(</span><span class="n">fico_score</span><span class="p">)</span>
    <span class="n">prev_or_new_cust</span> <span class="o">=</span> <span class="n">previous_customer_label</span><span class="p">(</span><span class="n">is_previous_customer</span><span class="p">)</span>

    <span class="n">customer_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{minor_or_adult}</span><span class="s2">: </span><span class="si">{credit_rating}</span><span class="s2"> (</span><span class="si">{prev_or_new_cust}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
        <span class="s1">&#39;minor_or_adult&#39;</span><span class="p">:</span> <span class="n">minor_or_adult</span><span class="p">,</span>
        <span class="s1">&#39;credit_rating&#39;</span><span class="p">:</span> <span class="n">credit_rating</span><span class="p">,</span>
        <span class="s1">&#39;prev_or_new_cust&#39;</span><span class="p">:</span> <span class="n">prev_or_new_cust</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">customer_label</span>
</code></pre></div></td></tr></table></div>

<p>I'm being a bit sloppy here with an early return in the <code>for</code>-loop, but we'll fix this soon.  In particular, <strong>mypy</strong> won't be happy with that early return, as it's possible the function could return <code>None</code>.</p>
<p><strong>Reader</strong>: Did you notice that there was a typo in the code, which would cause a null return if someone had a credit score of, say, 630?  Refactoring this code fixed that issue and made it significantly easier to extend, change, or check bounds.</p>
<h2 id="more-refactoring">More Refactoring?</h2>
<h3 id="todo-is-this-necessary">TODO: IS THIS NECESSARY?</h3>
<h3 id="todo-proofread-stop-here">TODO: PROOFREAD STOP HERE.</h3>
<p>Some people would stop at this point &mdash; and, unfortunately, many would have stopped way before this point.</p>
<p>When I made the smaller functions I made one big function (<code>main</code>) pass parameters into smaller functions as arguments. Since these smaller functions exist only to help <code>main</code>, an I'm probably not going to be using this function elsewhere, this feels like a code-smell.  Indeed, this code smell could mean that I should introduce a class-type structure in our code.  Let's add this to the list, and then take a crack at some of these other bullet-point issues.  Let's try to do this one first:</p>
<p>Make a Class and Encapsulate</p>
<p>For some Python students, this may be the scariest step.  It's difficult to say when something ought to be a class as opposed to a function; indeed, many times it leads to some fairly heated arguments!  Nevertheless, in this case I will do it to explain how to do it.  (Note: I would favor a class in this case because of the number of parameters I'm passing as arguments to smaller business-logic-type functions.)</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># FIFTH REFACTOR: CLASS.</span>

<span class="c1"># customer_type.py</span>
<span class="n">FICO_UPPER_BOUNDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Deep-Subprime&quot;</span><span class="p">:</span> <span class="mi">579</span><span class="p">,</span>
    <span class="s2">&quot;Subprime&quot;</span><span class="p">:</span> <span class="mi">619</span><span class="p">,</span>
    <span class="s2">&quot;Near-Prime&quot;</span><span class="p">:</span> <span class="mi">659</span><span class="p">,</span>
    <span class="s2">&quot;Prime&quot;</span><span class="p">:</span> <span class="mi">719</span><span class="p">,</span>
    <span class="s2">&quot;Super-Prime&quot;</span><span class="p">:</span> <span class="mi">850</span>
<span class="p">}</span>

<span class="n">MINOR_AGE_UPPER_BOUND</span> <span class="o">=</span> <span class="mi">18</span>

<span class="k">class</span> <span class="nc">CustomerLabel</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fico_score</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_previous_customer</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fico_score</span> <span class="o">=</span> <span class="n">fico_score</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_previous_customer</span> <span class="o">=</span> <span class="n">is_previous_customer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">customer_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_customer_label</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">customer_age_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
         <span class="k">return</span> <span class="s2">&quot;Minor&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;</span> <span class="n">MINOR_AGE_UPPER_BOUND</span> <span class="k">else</span> <span class="s2">&quot;Adult&quot;</span>

    <span class="k">def</span> <span class="nf">credit_rating_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="n">FICO_UPPER_BOUNDS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fico_score</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">lbl</span>

        <span class="c1"># TODO: Put a LOG here to make it known that a label was not returned correctly!</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">previous_customer_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Previous Customer&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_previous_customer</span> <span class="k">else</span> <span class="s2">&quot;New Customer&quot;</span>

    <span class="k">def</span> <span class="nf">create_customer_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">customer_age_label</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">credit_rating_label</span><span class="p">()</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_customer_label</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>

<span class="c1"># Usage:</span>
<span class="n">customer_label</span> <span class="o">=</span> <span class="n">CustomerLabel</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fico_score</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">is_previous_customer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">customer_label</span>
</code></pre></div></td></tr></table></div>

<p>Notice that I've put a structure around this code which makes it trivial to add additional things to the label if I need to.  It also allows us to change the format of the label if that is required.  It is robust, scalable to new business logic, and easy to read through.  There is that weird "usage" thing at the bottom, though...</p>
<h2 id="docstrings-misc">Docstrings &amp; Misc</h2>
<p>I'm going to add docstrings at this point, since I'm fairly satisfied with the structure of the code.  There are a few tools which allows your editor to generate templates for these docstrings for you, giving you no excuse to not write them!  There are many different ways to write docstrings, so be consistent in your codebase.  If you use something like Sphinx or Swagger, make sure you conform to the required docstring formats.  I will use <a href="https://numpydoc.readthedocs.io/en/latest/format.html">Numpy style docstrings</a> in this sample.</p>
<p>We've also done some minor cleanup, as noted at the top.  These are minute things which I thought might be nice as I went through the code one last time.  Additionally, we've used <a href="https://github.com/psf/black">Black</a> to format the code and make it look nice.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="sd">&quot;&quot;&quot;CustomerLabel class.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="n">FICO_UPPER_BOUNDS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Deep-Subprime&quot;</span><span class="p">:</span> <span class="mi">579</span><span class="p">,</span>
    <span class="s2">&quot;Subprime&quot;</span><span class="p">:</span> <span class="mi">619</span><span class="p">,</span>
    <span class="s2">&quot;Near-Prime&quot;</span><span class="p">:</span> <span class="mi">659</span><span class="p">,</span>
    <span class="s2">&quot;Prime&quot;</span><span class="p">:</span> <span class="mi">719</span><span class="p">,</span>
    <span class="s2">&quot;Super-Prime&quot;</span><span class="p">:</span> <span class="mi">850</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">MINOR_AGE_UPPER_BOUND</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">18</span>


<span class="k">class</span> <span class="nc">CustomerLabel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a customer label.</span>

<span class="sd">    The customer label format is: &#39;Adult/Minor Credit_Rating New/Returning_Customer&#39;</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    get_customer_label()</span>
<span class="sd">         Return the formatted label.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; customer_label = CustomerLabel(</span>
<span class="sd">    ...     age=17,</span>
<span class="sd">    ...     fico_score=550,</span>
<span class="sd">    ...     is_previous_customer=False</span>
<span class="sd">    ... ).get_customer_label()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fico_score</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_previous_customer</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a customer label.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        age : int</span>
<span class="sd">            Age of the customer in years</span>
<span class="sd">        fico_score : int</span>
<span class="sd">            FICO score of the customer</span>
<span class="sd">        is_previous_customer : bool</span>
<span class="sd">            If the customer is a previous customer or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fico_score</span> <span class="o">=</span> <span class="n">fico_score</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_previous_customer</span> <span class="o">=</span> <span class="n">is_previous_customer</span>

    <span class="k">def</span> <span class="nf">_customer_age_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the customer&#39;s age label.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Minor&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;</span> <span class="n">MINOR_AGE_UPPER_BOUND</span> <span class="k">else</span> <span class="s2">&quot;Adult&quot;</span>

    <span class="k">def</span> <span class="nf">_credit_rating_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the label for credit rating given the FICO bounds.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="n">FICO_UPPER_BOUNDS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fico_score</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">lbl</span>

        <span class="c1"># TODO: Put a LOG here to make it known that a label was not returned correctly!</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_previous_customer_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return corresponding label for previous customer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Previous Customer&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_previous_customer</span> <span class="k">else</span> <span class="s2">&quot;New Customer&quot;</span>

    <span class="k">def</span> <span class="nf">get_customer_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate and returns a customer label.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_customer_age_label</span><span class="p">()</span><span class="si">}</span><span class="s2">: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_credit_rating_label</span><span class="p">()</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_previous_customer_label</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>

<h2 id="are-i-done">Are I Done?</h2>
<p>The code looks clean, has docstrings and an example, and doesn't have any obvious code smells.  There is a TODO that I left, which should be converted to a ticket so that I don't forget about it — but, at least, I ought to note it in the code.  Most text editors will be able to show you the "TODO" items you have in your code and it's good to go over these every so often.</p>
<p>Are I done?  I'm sure some of you think that something is still amiss, that something could be done better, that something could be changed — for example, why have a function which converts our bool to an age label when I can do the conversion quickly and easily on one line in our <code>__init__</code>?  There are several other optimizations which could be argued for.</p>
<p>Would you have refactored things differently?  Will our refactor (or your refactor) still be useable if our boss tells us to change the label, add in new arguments, or create different calculations for labels?  Would it be easy for someone new to look at the code and understand what it does?  Would it be easy for someone to look at the code if they were making something which used it as an input or an output?</p>
<h2 id="conclusion">Conclusion</h2>
<p>My personal feeling is that refactoring is important enough to get a dedicated day during a sprint; it not only will reduce technical debt, get new users familiar with the code, and clean things up, but it will make the code readable and usable for years to come.</p>
<p>There may be those who resist refactoring, call it a waste of time, or tell you that they write perfect code the first time.  <strong>Read through their code and decide for yourself.</strong></p>
    </div>
</body>

</html>